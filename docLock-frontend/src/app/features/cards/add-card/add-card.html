<div class="min-h-screen bg-gradient-to-br from-yellow-50 via-amber-50 to-orange-50 flex flex-col relative">
    <!-- Yellow top border line -->
    <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-yellow-500 via-amber-500 to-yellow-500 z-50">
    </div>

    <!-- Sophisticated Background Elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div
            class="absolute -top-32 -right-32 w-64 h-64 bg-gradient-to-br from-yellow-400/10 to-amber-500/10 rounded-full animate-float-slow">
        </div>
        <div
            class="absolute -bottom-24 -left-24 w-48 h-48 bg-gradient-to-tr from-orange-400/8 to-yellow-500/8 rounded-full animate-float-reverse">
        </div>
        <div
            class="absolute top-1/4 right-1/3 w-32 h-32 bg-gradient-to-br from-amber-300/6 to-yellow-400/6 rounded-full animate-pulse-slow">
        </div>
        <div
            class="absolute bottom-1/3 left-1/4 w-20 h-20 bg-gradient-to-br from-slate-300/8 to-yellow-300/8 rounded-full animate-float">
        </div>
    </div>

    <!-- Content Wrapper with Max Width -->
    <div class="w-full max-w-[639px] mx-auto flex flex-col relative z-10"
        style="height: calc(100vh - 5rem); max-height: calc(100vh - 5rem);">
        <!-- Mobile-First Header - Fixed -->
        <header class="flex-none p-4 pt-12">
            <div class="flex items-center justify-center mb-4 relative">
                <!-- Back Button -->
                <a routerLink="/cards"
                    class="absolute left-0 w-10 h-10 rounded-xl bg-white/90 backdrop-blur-xl border border-white/60 shadow-lg flex items-center justify-center text-slate-500 active:text-slate-900 active:bg-white transition-all active:scale-95 touch-manipulation">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                    </svg>
                </a>

                <!-- Centered Title -->
                <div class="text-center">
                    <h1 class="text-xl font-bold text-slate-800 tracking-tight">{{editingCard ? 'Edit Card' : 'Add New
                        Card'}}</h1>
                </div>
            </div>
        </header>

        <!-- Dynamic Card Preview - Fixed Static Position -->
        <div class="flex-none px-4 pb-4">
            <div class="max-w-sm mx-auto">
                <div
                    class="w-full max-w-[340px] mx-auto aspect-[1.586/1] rounded-2xl p-5 text-white shadow-2xl relative overflow-hidden animate-fade-in bg-gradient-to-br from-yellow-600 to-amber-700">

                    <!-- Card Pattern Overlay -->
                    <div class="absolute inset-0 bg-gradient-to-tr from-white/10 to-transparent pointer-events-none">
                    </div>
                    <div class="absolute top-4 right-4 px-3 py-1.5 bg-white/20 rounded-lg">
                        <div class="text-xs font-bold whitespace-nowrap text-center">{{getBrandName(selectedBrand)}}
                        </div>
                    </div>

                    <div class="flex flex-col h-full justify-between relative z-10">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-xs opacity-80 font-medium uppercase tracking-wider">{{newCard.name ||
                                    'Card Name'}}</span>
                                <div class="text-xs opacity-60 mt-1">{{newCard.type === 'credit' ? 'CREDIT CARD' :
                                    'DEBIT CARD'}}</div>
                            </div>
                        </div>

                        <div class="text-center my-4">
                            <p class="font-mono text-xl tracking-widest">
                                {{ newCard.number || '0000 0000 0000 0000' }}
                            </p>
                        </div>

                        <div class="flex justify-between items-end">
                            <div>
                                <p class="text-xs uppercase opacity-60 mb-1">Card Holder</p>
                                <p class="uppercase text-sm font-medium tracking-wide">{{ newCard.holderName || 'YOUR
                                    NAME' }}</p>
                            </div>
                            <div class="flex gap-4">
                                <div>
                                    <p class="text-xs uppercase opacity-60 mb-1">Expires</p>
                                    <p class="font-mono text-sm">{{ newCard.expiryDate || 'MM/YY' }}</p>
                                </div>
                                <div>
                                    <p class="text-xs uppercase opacity-60 mb-1">CVV</p>
                                    <p class="font-mono text-sm">{{ newCard.cvv || '•••' }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Section - Only Scrollable Area -->
        <div class="flex-1 min-h-0 overflow-y-auto px-4">
            <div class="max-w-sm mx-auto w-full">
                <div class="animate-fade-in space-y-6 pt-4" style="animation-delay: 200ms;">
                    <!-- Card Type Selection -->
                    <div>
                        <label class="block text-sm font-bold text-slate-900 mb-3">Card Type</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button type="button" (click)="selectCardType('debit')"
                                [class]="newCard.type === 'debit' ? 'bg-emerald-500 text-white shadow-lg border-2 border-emerald-500' : 'bg-white/90 backdrop-blur-xl border border-yellow-600/30 text-slate-600 hover:bg-slate-50'"
                                class="flex items-center justify-center gap-2 p-3 rounded-2xl font-medium transition-all active:scale-95">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                Debit Card
                            </button>
                            <button type="button" (click)="selectCardType('credit')"
                                [class]="newCard.type === 'credit' ? 'bg-yellow-500 text-white shadow-lg border-2 border-yellow-500' : 'bg-white/90 backdrop-blur-xl border border-yellow-600/30 text-slate-600 hover:bg-slate-50'"
                                class="flex items-center justify-center gap-2 p-3 rounded-2xl font-medium transition-all active:scale-95">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                </svg>
                                Credit Card
                            </button>
                        </div>
                    </div>



                    <!-- Card Name -->
                    <div>
                        <label class="block text-sm font-bold text-slate-900 mb-3">Card Name</label>
                        <div class="relative">
                            <div class="absolute inset-0 bg-gradient-to-r from-yellow-500/5 to-amber-500/5 rounded-2xl">
                            </div>
                            <input [(ngModel)]="newCard.name" (input)="formatInputName($event)" type="text"
                                autocomplete="cc-name" maxlength="40" placeholder="e.g., Personal Visa, Business Card"
                                (contextmenu)="$event.preventDefault()"
                                class="relative w-full bg-white/90 backdrop-blur-xl border-2 border-white/60 rounded-2xl px-4 py-4 text-slate-800 placeholder-slate-500 focus:outline-none focus:border-yellow-400 focus:ring-4 focus:ring-yellow-500/10 transition-all shadow-lg">
                        </div>
                    </div>

                    <!-- Card Number -->
                    <div>
                        <label class="block text-sm font-bold text-slate-900 mb-3">Card Number</label>
                        <div class="relative">
                            <div class="absolute inset-0 bg-gradient-to-r from-yellow-500/5 to-amber-500/5 rounded-2xl">
                            </div>
                            <input type="text" [value]="newCard.number" (input)="formatInputCardNumber($event)"
                                autocomplete="cc-number" placeholder="0000 0000 0000 0000" maxlength="19"
                                (contextmenu)="$event.preventDefault()"
                                class="relative w-full bg-white/90 backdrop-blur-xl border-2 border-white/60 rounded-2xl px-4 py-4 font-mono text-slate-800 placeholder-slate-500 focus:outline-none focus:border-yellow-400 focus:ring-4 focus:ring-yellow-500/10 transition-all shadow-lg">
                        </div>
                    </div>

                    <!-- Card Holder Name -->
                    <div>
                        <label class="block text-sm font-bold text-slate-900 mb-3">Card Holder Name</label>
                        <div class="relative">
                            <div class="absolute inset-0 bg-gradient-to-r from-yellow-500/5 to-amber-500/5 rounded-2xl">
                            </div>
                            <input [(ngModel)]="newCard.holderName" (input)="formatInputHolderName($event)" type="text"
                                autocomplete="cc-name" maxlength="24" placeholder="JOHN DOE"
                                (contextmenu)="$event.preventDefault()"
                                class="relative w-full bg-white/90 backdrop-blur-xl border-2 border-white/60 rounded-2xl px-4 py-4 text-slate-800 uppercase placeholder-slate-500 focus:outline-none focus:border-yellow-400 focus:ring-4 focus:ring-yellow-500/10 transition-all shadow-lg">
                        </div>
                    </div>

                    <!-- Expiry and CVV -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-slate-900 mb-3">Expiry Date</label>
                            <div class="relative">
                                <div
                                    class="absolute inset-0 bg-gradient-to-r from-yellow-500/5 to-amber-500/5 rounded-2xl">
                                </div>
                                <input type="text" [value]="newCard.expiryDate" (input)="formatInputExpiry($event)"
                                    autocomplete="cc-exp" placeholder="MM/YY" maxlength="5"
                                    (contextmenu)="$event.preventDefault()"
                                    class="relative w-full bg-white/90 backdrop-blur-xl border-2 border-white/60 rounded-2xl px-4 py-4 font-mono text-slate-800 placeholder-slate-500 focus:outline-none focus:border-yellow-400 focus:ring-4 focus:ring-yellow-500/10 transition-all shadow-lg">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-900 mb-3">CVV</label>
                            <div class="relative">
                                <div
                                    class="absolute inset-0 bg-gradient-to-r from-yellow-500/5 to-amber-500/5 rounded-2xl">
                                </div>
                                <input [(ngModel)]="newCard.cvv" (input)="formatInputCVV($event)" type="password"
                                    autocomplete="cc-csc" placeholder="123" maxlength="3"
                                    (contextmenu)="$event.preventDefault()"
                                    class="relative w-full bg-white/90 backdrop-blur-xl border-2 border-white/60 rounded-2xl px-4 py-4 font-mono text-slate-800 placeholder-slate-500 focus:outline-none focus:border-yellow-400 focus:ring-4 focus:ring-yellow-500/10 transition-all shadow-lg">
                            </div>
                        </div>
                    </div>

                    <!-- Action Button -->
                    <button (click)="addCard()" [disabled]="isLoading"
                        class="w-full h-14 rounded-2xl bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold text-lg shadow-lg shadow-yellow-500/25 active:shadow-yellow-500/40 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100 flex items-center justify-center touch-manipulation mb-6">
                        <span *ngIf="!isLoading">{{editingCard ? 'Update Card' : 'Add Card'}}</span>
                        <span *ngIf="isLoading" class="flex items-center gap-2">
                            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            Processing...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>