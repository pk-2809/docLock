<div class="profile-container h-full overflow-hidden text-white p-4">
    <!-- Header -->
    <header class="flex items-center gap-4 mb-8 pt-2">
        <a routerLink="/dashboard"
            class="w-10 h-10 rounded-full glass-card flex items-center justify-center text-slate-400 hover:text-white transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
        </a>
        <h1 class="text-xl font-bold tracking-tight">My Profile</h1>
        <button (click)="copyProfileLink()"
            class="ml-auto text-xs font-bold text-indigo-400 hover:text-indigo-300 transition-colors bg-indigo-500/10 px-3 py-1.5 rounded-full">
            Copy Link
        </button>
    </header>

    <!-- User Info Card -->
    <section class="flex flex-col items-center justify-center mb-6 animate-fade-in">

        <div class="relative w-24 h-24 mb-4 group cursor-pointer" (click)="fileInput.click()">
            <!-- Gradient Ring -->
            <div class="absolute inset-0 rounded-full p-[2px] bg-gradient-to-tr from-indigo-500 to-fuchsia-500">
                <div class="w-full h-full rounded-full bg-slate-900"></div>
            </div>

            <!-- Avatar Image / Placeholder -->
            <div
                class="absolute inset-[4px] rounded-full overflow-hidden bg-slate-900 flex items-center justify-center">
                <img *ngIf="user()?.role === 'user' && user()?.profileImage" [src]="user()?.profileImage"
                    class="w-full h-full object-cover rounded-full" alt="Profile">

                <svg *ngIf="!(user()?.profileImage)" class="w-10 h-10 text-slate-500" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>

            <!-- Edit Overlay -->
            <div *ngIf="!isUploading()"
                class="absolute inset-0 rounded-full bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </div>

            <!-- Loading Overlay -->
            <div *ngIf="isUploading()"
                class="absolute inset-0 rounded-full bg-black/70 flex items-center justify-center animate-fade-in">
                <div class="w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
            </div>
        </div>

        <!-- Hidden File Input -->
        <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" class="hidden">

        <h2 class="text-2xl font-bold mb-1">{{ (user()?.name) || 'User' }}</h2>
        <p class="text-slate-400 text-sm font-medium mb-3">{{ (user()?.mobile) || 'No mobile' }}</p>
    </section>

    <!-- Stats Grid -->
    <section class="grid grid-cols-2 gap-4 mb-8 animate-slide-in">
        <div class="glass-card p-4">
            <div class="flex items-center gap-2 mb-2">
                <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center text-indigo-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                        </path>
                    </svg>
                </div>
                <span class="text-xs text-slate-400 font-bold uppercase">Storage</span>
            </div>
            <p class="text-2xl font-black mb-1 gradient-text">{{ stats.storageUsed }}%</p>
            <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-indigo-500 to-fuchsia-500" [style.width.%]="stats.storageUsed">
                </div>
            </div>
        </div>

        <div class="glass-card p-4">
            <div class="flex items-center gap-2 mb-2">
                <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                </div>
                <span class="text-xs text-slate-400 font-bold uppercase">Docs</span>
            </div>
            <p class="text-2xl font-black mb-1 text-white">{{ stats.documents }}</p>
            <p class="text-[10px] text-slate-500">Total uploaded</p>
        </div>
    </section>

    <!-- Menu Actions -->
    <section class="space-y-3 animate-fade-in" style="animation-delay: 200ms;">
        <h3 class="text-slate-500 text-xs font-bold uppercase tracking-wider px-1">Settings</h3>

        <button (click)="changeMpin()"
            class="w-full glass-card p-4 flex items-center justify-between group hover:bg-slate-800 transition-colors text-left">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 group-hover:text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                        </path>
                    </svg>
                </div>
                <div>
                    <h4 class="font-bold text-sm">Security</h4>
                    <p class="text-xs text-slate-500">Change MPIN, Biometrics</p>
                </div>
            </div>
            <svg class="w-5 h-5 text-slate-600 group-hover:text-slate-400 transition-colors" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </button>

        <a routerLink="/my-qr"
            class="w-full glass-card p-4 flex items-center justify-between group hover:bg-slate-800 transition-colors text-left block">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 group-hover:text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M12 12h-4.01M12 12v4m6-4h.01M12 8h.01M12 8h4.01M12 8h-4.01">
                        </path>
                    </svg>
                </div>
                <div>
                    <h4 class="font-bold text-sm">My QR Code</h4>
                    <p class="text-xs text-slate-500">Share your profile</p>
                </div>
            </div>
            <svg class="w-5 h-5 text-slate-600 group-hover:text-slate-400 transition-colors" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>

        <button (click)="initiateLogout()"
            class="w-full glass-card p-4 flex items-center justify-between group hover:bg-red-500/10 transition-colors text-left mt-4">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-red-400 group-hover:text-red-500 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                        </path>
                    </svg>
                </div>
                <div>
                    <h4 class="font-bold text-sm text-red-400 group-hover:text-red-500">Logout</h4>
                    <p class="text-xs text-slate-500 group-hover:text-red-400/70">Sign out of this device</p>
                </div>
            </div>
        </button>
    </section>


    <!-- MPIN Setup Sheet -->
    <div *ngIf="showMpinSheet"
        class="fixed inset-0 z-[60] flex items-end justify-end bg-black/60 backdrop-blur-sm animate-fade-in"
        (click)="closeMpinSheet()">
        <div class="bg-slate-900 w-full h-[70vh] sm:max-w-md rounded-t-3xl p-6 shadow-2xl animate-slide-in-up border border-slate-700/50 relative overflow-hidden"
            (click)="$event.stopPropagation()">
            <app-mpin-setup (close)="closeMpinSheet()" (success)="closeMpinSheet()"></app-mpin-setup>
        </div>
    </div>
</div>