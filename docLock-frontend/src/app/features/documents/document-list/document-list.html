<!-- Documents Page -->
<div class="min-h-screen bg-slate-50 flex flex-col overflow-hidden relative">
    <!-- Blue top border line -->
    <div class="absolute top-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-indigo-500 to-blue-500 z-50"></div>


    <!-- Loading Skeleton -->
    @if (isLoading) {
    <div class="px-4 sm:px-6 py-8 animate-pulse relative z-10">
        <!-- Header Skeleton -->
        <div class="text-center mb-12 pt-6">
            <div class="w-24 h-24 mx-auto mb-6 bg-slate-200 rounded-full"></div>
            <div class="h-10 w-48 mx-auto bg-slate-200 rounded mb-3"></div>
            <div class="h-6 w-32 mx-auto bg-slate-200 rounded"></div>
        </div>

        <!-- Main Card Skeleton -->
        <div class="mb-8">
            <div class="bg-white rounded-3xl p-8 h-64 border border-slate-100"></div>
        </div>

        <!-- Grid Skeleton -->
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white rounded-2xl h-40"></div>
            <div class="bg-white rounded-2xl h-40"></div>
        </div>
    </div>
    } @else {

    <!-- Folders View -->
    @if (viewMode === 'folders') {
    <div class="px-4 sm:px-6 py-4 flex flex-col overflow-hidden relative z-10"
        style="height: calc(100vh - 5rem); max-height: calc(100vh - 5rem);">
        <!-- Enhanced Header -->
        <header class="mb-4 shrink-0 pt-8">
            <!-- Top Navigation -->
            <div class="flex items-center justify-center mb-6 relative">
                <!-- Centered Title -->
                <div class="text-center">
                    <h1 class="text-xl font-bold text-slate-800 tracking-tight">My Documents</h1>
                </div>

                <!-- Back Button (when not in root) -->
                @if (!currentFolderId) {
                <button (click)="goBack()"
                    class="absolute left-0 w-10 h-10 rounded-xl bg-white shadow-lg flex items-center justify-center text-slate-600 active:text-blue-600 transition-all active:scale-95 touch-manipulation">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                    </svg>
                </button>
                }
            </div>

            <!-- Enhanced Search Bar -->
            <div class="mb-4 px-1">

                <div class="relative">
                    <div class="absolute inset-0 bg-blue-500/5 rounded-xl sm:rounded-2xl"></div>
                    <input type="text" (input)="onSearch($event)" (focus)="onSearch($event)"
                        placeholder="Search documents..."
                        class="relative w-full pl-10 sm:pl-12 pr-4 py-3 sm:py-4 bg-white/90 backdrop-blur-xl border-2 border-white/60 rounded-xl sm:rounded-2xl text-slate-800 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all shadow-lg font-medium text-sm sm:text-base z-30">
                    <div class="absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 text-slate-500 z-30">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>

                    <!-- Search Results Dropdown -->
                    @if (showSearchPanel) {
                    <!-- Backdrop to close on outside click -->
                    <div class="fixed inset-0 z-20" (click)="closeSearchPanel()"></div>

                    <div
                        class="absolute top-full left-0 right-0 mt-3 bg-white rounded-2xl shadow-[0_10px_40px_rgba(0,0,0,0.1)] border border-slate-100 overflow-hidden z-40 flex flex-col animate-fade-in w-full ring-1 ring-black/5">
                        @if (searchResults.length > 0) {
                        <!-- Beautiful Header -->
                        <div
                            class="px-4 py-3 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between shrink-0">
                            <h3
                                class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                Search Results
                            </h3>
                            <span
                                class="bg-blue-100 text-blue-700 py-1 px-2.5 rounded-full text-[10px] font-bold shadow-sm ring-1 ring-blue-200">
                                {{searchResults.length}} found
                            </span>
                        </div>

                        <!-- List -->
                        <div class="overflow-y-auto p-2 space-y-1 max-h-[340px]">
                            @for (result of searchResults; track result.doc.id) {
                            <button (click)="openDocument(result.doc)"
                                class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 active:bg-slate-100 transition-all text-left group border border-transparent hover:border-slate-100 relative overflow-hidden"
                                [class.pointer-events-none]="loadingDocumentId && loadingDocumentId !== result.doc.id"
                                [class.opacity-50]="loadingDocumentId && loadingDocumentId !== result.doc.id">

                                <!-- Spinner Overlay for Selected Item -->
                                @if (loadingDocumentId === result.doc.id) {
                                <div
                                    class="absolute inset-0 bg-white/60 backdrop-blur-[1px] flex items-center justify-center z-10">
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="w-2 h-2 bg-blue-600 rounded-full animate-bounce [animation-delay:-0.3s]"></span>
                                        <span
                                            class="w-2 h-2 bg-blue-600 rounded-full animate-bounce [animation-delay:-0.15s]"></span>
                                        <span class="w-2 h-2 bg-blue-600 rounded-full animate-bounce"></span>
                                    </div>
                                </div>
                                }

                                <!-- Icon -->
                                <div
                                    class="w-10 h-10 {{getDocumentIconGradient(result.doc)}} rounded-lg flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-200">
                                    <svg class="w-5 h-5 {{getDocumentIconColor(result.doc)}}" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            [attr.d]="getIconSvg(result.doc.icon || 'document')" />
                                    </svg>
                                </div>
                                <!-- Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-0.5">
                                        <h4
                                            class="text-sm font-bold text-slate-800 truncate group-hover:text-blue-600 transition-colors">
                                            {{result.doc.name}}</h4>
                                    </div>
                                    <div class="flex items-center gap-1.5 text-[10px] text-slate-400">
                                        <svg class="w-3 h-3 text-slate-300" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 00-1.883 2.542l.857 6a2.25 2.25 0 002.227 1.932H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-1.883-2.542m-16.5 0V6A2.25 2.25 0 016 3.75h3.879a1.5 1.5 0 011.06.44l2.122 2.12a1.5 1.5 0 001.06.44H18A2.25 2.25 0 0120.25 9v.776" />
                                        </svg>
                                        <span class="truncate">{{result.path}}</span>
                                    </div>
                                </div>

                                <!-- Arrow Icon (Hidden when loading) -->
                                @if (loadingDocumentId !== result.doc.id) {
                                <svg class="w-4 h-4 text-slate-300 group-hover:text-blue-400 group-hover:translate-x-0.5 transition-all opacity-0 group-hover:opacity-100"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7" />
                                </svg>
                                }
                            </button>
                            }
                        </div>
                        } @else {
                        <div class="p-8 text-center flex flex-col items-center justify-center">
                            <div
                                class="w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center text-slate-300 mb-3">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                            <p class="text-slate-500 text-sm font-medium">No results found for "{{searchQuery}}"</p>
                            <p class="text-slate-400 text-xs mt-1">Try checking your spelling or use different keywords
                            </p>
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>

            <!-- Enhanced Breadcrumbs -->
            @if (currentFolderId) {
            <div class="mb-4 w-full px-1">
                <div class="flex items-center gap-2 overflow-x-auto no-scrollbar" #breadcrumbContainer>
                    <!-- Breadcrumb Path -->
                    <div
                        class="flex items-center gap-1.5 bg-white px-3 py-2 rounded-xl shadow-sm border border-slate-200 overflow-x-auto flex-1 no-scrollbar">
                        <button (click)="navigateToBreadcrumb({id: 'root', name: 'Home', path: 'root'})"
                            class="flex items-center gap-1.5 px-2 py-1 rounded-lg active:bg-blue-50 text-slate-500 active:text-blue-600 transition-colors flex-shrink-0 touch-manipulation">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                            </svg>
                            <span class="text-xs font-bold uppercase tracking-wider hidden sm:inline-block">Home</span>
                        </button>

                        @for (item of breadcrumbs; track item.id) {
                        @if (item.id !== 'root') {
                        <svg class="w-3 h-3 text-slate-300 flex-shrink-0" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                        </svg>
                        <button (click)="navigateToBreadcrumb(item)"
                            class="px-2 py-1 rounded-lg text-sm font-medium transition-all whitespace-nowrap touch-manipulation"
                            [class]="item.id === currentFolderId ? 'text-blue-600 bg-blue-50 font-bold' : 'text-slate-600 active:text-blue-600 active:bg-slate-50'">
                            {{item.name}}
                        </button>
                        }
                        }
                    </div>
                </div>
            </div>
            }
        </header>

        <!-- Content Grid with enhanced styling -->
        <div class="flex-1 overflow-y-auto pb-4">
            @if (currentFolders.length > 0 || currentDocuments.length > 0) {
            <!-- Folders List -->
            @if (currentFolders.length > 0) {
            <div class="space-y-3 mb-4">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider px-2 mb-3">Folders</h3>
                @for (folder of currentFolders; track folder.id; let i = $index) {
                <div class="group bg-white/95 backdrop-blur-xl rounded-2xl p-4 shadow-lg border border-white/60 active:shadow-xl active:border-blue-200/60 active:scale-[0.98] transition-all cursor-pointer relative touch-manipulation animate-fade-in"
                    [class.z-50]="activeFolderMenu === folder.id" [style.animation-delay]="(i * 50) + 'ms'"
                    (click)="openFolder(folder.id)">

                    <!-- Hover overlay effect -->
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-indigo-500/5 rounded-2xl opacity-0 group-active:opacity-100 transition-opacity pointer-events-none">
                    </div>

                    <div class="flex items-center gap-4 relative z-10">
                        <!-- Enhanced Folder Icon with Pastel Background -->
                        <div
                            class="w-14 h-14 {{folder.id === 'shared-folder' ? 'bg-indigo-50' : (folder.color === 'bg-slate-500' ? 'bg-indigo-50' : (folder.color || 'bg-indigo-50'))}} rounded-2xl flex items-center justify-center {{folder.id === 'shared-folder' ? 'text-indigo-600' : 'text-blue-600'}} group-active:scale-110 transition-transform duration-300">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    [attr.d]="getIconSvg(folder.icon)" />
                            </svg>
                        </div>

                        <!-- Content / Edit Mode -->
                        <div class="flex-1 min-w-0">
                            @if (editFolderId === folder.id) {
                            <!-- Edit Input -->
                            <div class="flex items-center gap-2" (click)="$event.stopPropagation()">
                                <input type="text" [(ngModel)]="editFolderName" (keydown.enter)="saveEditFolder(folder)"
                                    (keydown.escape)="cancelEditFolder()"
                                    class="w-full bg-slate-50 border border-blue-200 rounded-xl px-3 py-2 text-sm text-slate-800 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-all"
                                    autofocus>
                                <button (click)="saveEditFolder(folder)"
                                    class="p-2 bg-blue-50 text-blue-600 rounded-xl active:bg-blue-100 active:scale-95 touch-manipulation transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7" />
                                    </svg>
                                </button>
                                <button (click)="cancelEditFolder()"
                                    class="p-2 bg-slate-50 text-slate-500 rounded-xl active:bg-slate-100 active:scale-95 touch-manipulation transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                            } @else {
                            <!-- Normal Display -->
                            <h3
                                class="text-slate-800 font-bold text-base group-active:text-blue-600 transition-colors duration-200 truncate mb-1">
                                {{folder.name}}</h3>
                            <p class="text-slate-500 text-xs font-medium">{{folder.itemCount || 0}} items</p>
                            }
                        </div>

                        <!-- Action Menu - Hide for Shared folder (virtual folder) -->
                        @if (editFolderId !== folder.id && folder.id !== 'shared-folder') {
                        <div class="relative">
                            <button (click)="$event.stopPropagation(); toggleFolderMenu(folder.id)"
                                class="p-2 rounded-xl text-slate-400 active:text-slate-600 active:bg-slate-100 active:scale-95 transition-all touch-manipulation">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                </svg>
                            </button>

                            @if (activeFolderMenu === folder.id) {
                            <div class="absolute right-0 top-full mt-2 bg-white/95 backdrop-blur-xl rounded-xl shadow-xl border border-white/60 py-1.5 z-50 min-w-[140px] animate-fade-in"
                                (click)="$event.stopPropagation()">

                                <button (click)="startEditFolder(folder); $event.stopPropagation()"
                                    class="w-full px-4 py-2 text-left active:bg-slate-50 transition-colors flex items-center gap-2.5 text-sm text-slate-600 touch-manipulation">
                                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                    </svg>
                                    Rename
                                </button>

                                <div class="h-px bg-slate-100 my-1"></div>

                                <button (click)="confirmDeleteFolder(folder); $event.stopPropagation()"
                                    class="w-full px-4 py-2 text-left active:bg-red-50 transition-colors flex items-center gap-2.5 text-sm text-red-500 touch-manipulation">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                    </svg>
                                    Delete
                                </button>
                            </div>
                            }
                        </div>
                        }
                    </div>
                </div>
                }
            </div>
            }

            <!-- Enhanced Documents List -->
            @if (currentDocuments.length > 0) {
            <div class="space-y-3">
                @for (doc of currentDocuments; track doc.id; let i = $index) {
                <div class="group bg-white/95 backdrop-blur-xl rounded-2xl p-4 shadow-lg border border-white/60 active:shadow-xl active:border-blue-200/60 active:scale-[0.98] transition-all cursor-pointer relative touch-manipulation animate-fade-in"
                    [class.z-50]="activeDocumentMenu === doc.id"
                    [class.opacity-50]="loadingDocumentId && loadingDocumentId !== doc.id"
                    [class.pointer-events-none]="loadingDocumentId && loadingDocumentId !== doc.id"
                    [style.animation-delay]="((currentFolders.length * 50) + (i * 50)) + 'ms'"
                    (click)="openDocument(doc)">

                    <!-- Hover overlay effect -->
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-indigo-500/5 rounded-2xl opacity-0 group-active:opacity-100 transition-opacity pointer-events-none">
                    </div>

                    <div class="flex items-center gap-4 relative z-10">
                        <!-- Enhanced Document Icon with Pastel Background -->
                        <div
                            class="w-14 h-14 {{getDocumentIconGradient(doc)}} rounded-2xl flex items-center justify-center group-active:scale-110 transition-transform duration-300">
                            <svg class="w-7 h-7 {{getDocumentIconColor(doc)}}" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    [attr.d]="getIconSvg(doc.icon || 'document')" />
                            </svg>
                        </div>

                        <!-- Document Info -->
                        <div class="flex-1 min-w-0">
                            <h3
                                class="text-slate-800 font-bold text-base group-active:text-blue-600 transition-colors duration-200 truncate mb-1">
                                {{doc.name}}</h3>
                            <p class="text-slate-500 text-sm font-medium">{{doc.type}} • {{formatFileSize(doc.size ||
                                0)}} • {{doc.date | date:'MMM d, y'}}</p>
                            @if (isSharedFolder) {
                            <div class="flex items-center gap-2 mt-2">
                                <div
                                    class="w-7 h-7 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shrink-0 shadow-md">
                                    <span
                                        class="text-[10px] font-bold text-white">{{getDocumentSharer(doc).initial}}</span>
                                </div>
                                <p class="text-slate-600 text-xs font-medium">Shared by {{getDocumentSharer(doc).name}}
                                </p>
                            </div>
                            }
                        </div>

                        <!-- Three Dot Menu / Spinner Loader -->
                        <div class="relative">
                            @if (loadingDocumentId === doc.id) {
                            <!-- Spinner Loader (Blue) -->
                            <div class="p-2">
                                <div
                                    class="w-5 h-5 border-2 border-blue-200 border-t-blue-500 rounded-full animate-spin">
                                </div>
                            </div>
                            } @else {
                            <!-- Three Dots Menu -->
                            <button (click)="$event.stopPropagation(); toggleDocumentMenu(doc.id)"
                                class="p-2 rounded-xl active:bg-slate-100 active:scale-95 text-slate-400 active:text-slate-600 transition-all touch-manipulation">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                </svg>
                            </button>

                            <!-- Dropdown Menu -->
                            @if (activeDocumentMenu === doc.id) {
                            <div (click)="$event.stopPropagation()"
                                class="absolute right-0 top-full mt-2 bg-white/95 backdrop-blur-xl rounded-xl shadow-xl border border-white/60 py-2 z-50 min-w-[140px] animate-fade-in">
                                <button (click)="downloadDocument(doc); closeDocumentMenu()"
                                    class="w-full px-4 py-2 text-left active:bg-slate-50 transition-colors flex items-center gap-3 text-sm text-slate-700 touch-manipulation">
                                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                                    </svg>
                                    Download
                                </button>
                                @if (!doc.sharedBy) {
                                <button (click)="shareDocument(doc); closeDocumentMenu()"
                                    class="w-full px-4 py-2 text-left active:bg-slate-50 transition-colors flex items-center gap-3 text-sm text-slate-700 touch-manipulation">
                                    <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                    </svg>
                                    Share
                                </button>
                                }
                                <div class="border-t border-slate-100 my-1"></div>
                                <button (click)="confirmDeleteDocument(doc); closeDocumentMenu()"
                                    class="w-full px-4 py-2 text-left active:bg-red-50 transition-colors flex items-center gap-3 text-sm text-red-600 touch-manipulation">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                    </svg>
                                    Delete
                                </button>
                            </div>
                            }
                            }
                        </div>
                    </div>
                </div>
                }
            </div>
            }
            } @else {
            <!-- Enhanced Empty State -->
            <div class="text-center py-20 animate-fade-in">
                <div class="relative mb-8 mx-auto w-32 h-32">
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-3xl animate-pulse-slow">
                    </div>
                    <div
                        class="relative w-32 h-32 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl flex items-center justify-center shadow-xl shadow-blue-500/20">
                        <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                        </svg>
                    </div>
                    <!-- Floating decorative elements -->
                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-blue-500/20 rounded-full animate-bounce delay-300">
                    </div>
                    <div
                        class="absolute -bottom-2 -left-2 w-4 h-4 bg-indigo-500/20 rounded-full animate-bounce delay-700">
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-slate-800 mb-3">No Documents Found</h3>
                <p class="text-slate-600 mb-8 font-medium max-w-sm mx-auto leading-relaxed">Start by uploading your
                    first document or creating a folder to organize your files</p>

                <!-- Enhanced Action Buttons -->
                <div class="flex items-center justify-center gap-3">
                    <button (click)="openCreateFolderModal()"
                        class="group flex items-center gap-2 px-6 py-3.5 bg-slate-600 active:bg-slate-700 text-white font-bold rounded-2xl shadow-lg shadow-slate-500/25 transition-all active:scale-95 touch-manipulation relative overflow-hidden">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 -translate-x-full group-active:translate-x-full transition-transform duration-700">
                        </div>
                        <svg class="w-5 h-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25H11.69z" />
                        </svg>
                        <span class="relative z-10">Folder</span>
                    </button>
                    <button (click)="openUploadModal()"
                        class="group flex items-center gap-2 px-6 py-3.5 bg-blue-600 active:bg-blue-700 text-white font-bold rounded-2xl shadow-lg shadow-blue-500/25 transition-all active:scale-95 touch-manipulation relative overflow-hidden">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 -translate-x-full group-active:translate-x-full transition-transform duration-700">
                        </div>
                        <svg class="w-5 h-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        <span class="relative z-10">Upload</span>
                    </button>
                </div>
            </div>
            }
        </div>
    </div>
    }

    <!-- Enhanced Floating Action Button -->
    @if (viewMode === 'folders' && (currentFolders.length > 0 || currentDocuments.length > 0)) {
    <div class="fixed bottom-14 right-1/2 transform translate-x-1/2 z-30">
        <div class="relative">
            <!-- Main FAB -->
            <button (click)="toggleFabMenu()"
                class="w-14 h-14 bg-blue-600 active:bg-blue-700 rounded-2xl shadow-2xl shadow-blue-500/30 flex items-center justify-center text-white transition-all active:scale-95 touch-manipulation"
                [class.rotate-45]="showFabMenu">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
            </button>

            <!-- FAB Menu -->
            @if (showFabMenu) {
            <div class="absolute bottom-16 left-1/2 transform -translate-x-1/2 flex flex-col gap-3">
                <!-- Create Folder -->
                <button (click)="openCreateFolderModal(); showFabMenu = false"
                    class="flex items-center gap-3 bg-slate-600 active:bg-slate-700 text-white px-4 py-3 rounded-2xl shadow-xl transition-all active:scale-95 whitespace-nowrap touch-manipulation">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25H11.69z" />
                    </svg>
                    <span class="font-medium">Create Folder</span>
                </button>
                <!-- Upload Document -->
                <button (click)="openUploadModal(); showFabMenu = false"
                    class="flex items-center gap-3 bg-blue-600 active:bg-blue-700 text-white px-4 py-3 rounded-2xl shadow-xl shadow-blue-500/25 transition-all active:scale-95 whitespace-nowrap touch-manipulation">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                    </svg>
                    <span class="font-medium">Upload Document</span>
                </button>
            </div>
            }
        </div>
    </div>
    }

    <!-- Create Folder Bottom Sheet -->
    <app-bottom-sheet [isOpen]="showCreateFolderModal" (closed)="closeCreateFolderModal()">
        <div class="flex flex-col w-full">
            <!-- Header -->
            <!-- Header -->
            <div class="text-center mb-6">
                <!-- Dynamic Auto-changing Icon -->
                <div
                    class="w-12 h-12 mx-auto mb-3 {{detectedColor === 'bg-blue-50' ? 'bg-blue-100' : detectedColor}} rounded-xl flex items-center justify-center transition-all duration-300">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            [attr.d]="getIconSvg(detectedIcon)" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">New Folder</h2>
            </div>

            <!-- Form -->
            <div class="space-y-4">
                <input type="text" [(ngModel)]="newFolderName" (input)="onFolderNameChange()" placeholder="Folder name"
                    autocomplete="off"
                    class="w-full bg-white border-2 border-slate-200 rounded-2xl px-4 py-4 text-slate-800 placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all font-medium text-lg shadow-sm">





                <!-- Buttons -->
                <div class="flex gap-3 pt-4">
                    <button (click)="closeCreateFolderModal()"
                        class="flex-1 px-6 py-4 bg-slate-100 active:bg-slate-200 text-slate-700 font-bold rounded-2xl transition-colors">
                        Cancel
                    </button>
                    <button (click)="createFolder()" [disabled]="!newFolderName.trim()"
                        class="flex-1 px-6 py-4 bg-blue-600 active:bg-blue-700 text-white font-bold rounded-2xl transition-all disabled:opacity-50 shadow-lg shadow-blue-200">
                        Create Folder
                    </button>
                </div>
            </div>
        </div>
    </app-bottom-sheet>

    <!-- Upload Document Bottom Sheet -->
    <app-bottom-sheet [isOpen]="showUploadModal" (closed)="closeUploadModal()">
        <div class="flex flex-col w-full">
            <!-- Header -->
            <div class="text-center mb-6">
                <div class="w-12 h-12 mx-auto mb-3 bg-blue-100 rounded-xl flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">Upload File</h2>
            </div>

            <!-- Upload Area -->
            <div class="space-y-4">
                <div [class.opacity-50]="isUploading" [class.pointer-events-none]="isUploading"
                    class="border-2 border-dashed border-slate-200 rounded-2xl p-8 text-center bg-slate-50 transition-colors hover:border-blue-400 hover:bg-blue-50/50">
                    <input type="file" #fileInput (change)="onFileSelected($event)" accept=".pdf,.jpg,.jpeg,.png"
                        class="hidden" [disabled]="isUploading">
                    <button (click)="fileInput.click()" class="w-full touch-manipulation" [disabled]="isUploading">
                        <svg class="w-10 h-10 mx-auto mb-3 text-blue-500" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                        </svg>
                        <p class="text-slate-900 font-bold mb-1">Tap to select file</p>
                        <p class="text-slate-400 text-sm">
                            PDF (Max {{ (appConfig.config().maxPdfSizeAllowed / (1024 * 1024)).toFixed(0) }}MB),
                            Images (Max {{ (appConfig.config().maxImgSizeAllowed / (1024 * 1024)).toFixed(0) }}MB)
                        </p>
                    </button>
                </div>

                @if (selectedFile) {
                <div class="bg-white rounded-2xl p-4 border border-slate-200 shadow-sm animate-fade-in">
                    <div class="flex items-center gap-4">
                        <div
                            class="w-10 h-10 {{getSelectedFileIconGradient()}} rounded-xl flex items-center justify-center shrink-0">
                            <svg class="w-5 h-5 {{getSelectedFileIconColor()}}" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    [attr.d]="getIconSvg(getSelectedFileIcon())" />
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-slate-900 font-bold text-sm truncate">{{selectedFile.name}}</p>
                            <p class="text-slate-500 text-xs mt-0.5">{{(selectedFile.size / (1024 * 1024)).toFixed(1)}}
                                MB</p>
                        </div>
                        <button (click)="selectedFile = null; documentName = ''" [disabled]="isUploading"
                            class="p-2 text-slate-400 hover:text-red-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                }

                <input type="text" [(ngModel)]="documentName" placeholder="Document name (optional)"
                    [disabled]="isUploading"
                    class="w-full bg-white border-2 border-slate-200 rounded-2xl px-4 py-4 text-slate-800 placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all font-medium text-lg disabled:opacity-50 disabled:bg-slate-50 shadow-sm">

                <!-- Buttons -->
                <div class="flex gap-3 pt-4">
                    <button (click)="closeUploadModal()" [disabled]="isUploading"
                        class="flex-1 px-6 py-4 bg-slate-100 active:bg-slate-200 text-slate-700 font-bold rounded-2xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Cancel
                    </button>
                    <button (click)="uploadDocument()" [disabled]="!selectedFile || isUploading"
                        class="flex-1 px-6 py-4 bg-blue-600 active:bg-blue-700 text-white font-bold rounded-2xl transition-all disabled:opacity-50 shadow-lg shadow-blue-200 flex items-center justify-center gap-2">
                        @if (isUploading) {
                        <div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                        <span>Uploading...</span>
                        } @else {
                        <span>Upload File</span>
                        }
                    </button>
                </div>
            </div>
        </div>
    </app-bottom-sheet>

    }
    <app-share-bottom-sheet [isOpen]="showShareSheet" [itemToShare]="itemToShare" (closed)="showShareSheet = false">
    </app-share-bottom-sheet>

    <app-dynamic-sheet [isOpen]="showDeleteSheet" [config]="{
            title: 'Delete Item?',
            message: deleteMessage,
            variant: 'danger',
            buttons: [
                { label: 'Yes, Delete', action: 'confirm', variant: 'danger', loading: isDeleting },
                { label: 'Cancel', action: 'cancel' }
            ]
        }" (confirmed)="executeDelete()" (closed)="closeDeleteSheet()">
    </app-dynamic-sheet>
</div>